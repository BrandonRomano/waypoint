---
layout: docs
page_title: Version 0.11.0 - Upgrade Guide
description: |-
This upgrade guide describes any considerations for upgrading to Waypoint 0.11.0.
---

# Upgrading to Waypoint 0.11.0 from 0.10.x

Waypoint 0.10.x can be upgraded to Waypoint 0.11.0 using a [standard upgrade](/waypoint/docs/upgrading#standard-upgrade).
There are some considerations depending on what platform your server is installed on.
There are no breaking changes in the protocol or `waypoint.hcl` configuration file.
Due to the changes in `runner` management, we cannot guarantee that all Waypoint
components (CLI, entrypoint, and server) are forwards and backwards
compatible. We encourage users to have all components on the same version.

## Server Snapshot

Waypoint servers at versions 0.10.4 and 0.10.5 have a [bug with taking snapshots](https://github.com/hashicorp/waypoint/pull/4523),
if there is a dynamic configuration source set, using the `config source-set`
command. If your server is running at either of these versions and a config
source is set, then you will not be able to take snapshots using the command
`server snapshot`. By default, the `server upgrade` command will also take a
snapshot of the database, and this also fails due to this bug.

There are a few options to upgrade to v0.11.0. If you do not need a snapshot of
the database before upgrading, then you may run `server upgrade` with the flag
`-snapshot=false` to proceed without issue.

Another alternative is to delete all config sources in your database using
`config source-set` with the `-delete` flag, and then running `server upgrade`.
After the server is upgraded, you can re-create the config sources using
`config source-set`.

A third approach is to use platform-native persistence solutions to back up the
file system where the Waypoint database is stored. This includes Docker, AWS
ECS, Kubernetes, and HashiCorp Nomad. The steps to do this with each of these
platforms are detailed below.

### Docker

### AWS ECS

The database of a Waypoint server installed to AWS ECS is persisted in a file
system, provided by the Elastic File System (EFS) service of AWS. To preserve
the database during the upgrade, a new EFS volume will need to be created. An
access point will need to be added to this volume as well. This access point's
path must be set to `/waypointserverdata`. The POSIX user and root directory
creation permissions should both have their user and group ID set to `100` and
`1000`, respectively. The access point permissions should be set to `755`.

The data in the old file system must be synchronized to the new one. This may be
done using [AWS DataSync](https://docs.aws.amazon.com/datasync/latest/userguide/what-is-datasync.html).
The source location should be configured as your old file system for the
Waypoint server and the destination should be configured as the file system you
just created.

Now that there are two file systems in EFS with the in your Waypoint database,
the next step is to upgrade the Waypoint server container to v0.11.0. To do
this, the task definition `waypoint-server` in ECS needs a new revision. The
only setting that must be changed is the image URI, which should be set to
`hashicorp/waypoint:0.11.0`. After the new revision of the task definition is
created, the `waypoint-server` service in ECS must be updated to use the
revision you just created.

If it is necessary to restore the snapshot to Waypoint, then a new revision of
the ECS task definition `waypoint-server` needs to be created. In this new
version, the storage configuration must be updated to replace the existing file
system with the one created as part of this snapshot process. With that updated,
the `waypoint-server` ECS service needs to be updated once more to use the
newest revision of the `waypoint-server` task definition. At this point, the
server should be using the pre-upgrade snapshot of the database.

### Kubernetes

### HashiCorp Nomad

Taking a snapshot of the Waypoint server's database before an upgrade will
depend on what storage Waypoint was initially setup with. For host mounted
volumes you will need to make a manual backup of the host volume itself and
attempt the upgrade with snapshots disabled.

If you previously installed Waypoint using a CSI driver, it is possible to use
the snapshot feature of the CSI driver to ensure a snapshot of your server is
taken before upgrading. Run the following steps to take a snapshot.

  1. Stop Waypoint server
  2. Take a snapshot of the volume Waypoint used for server installation in Nomad
  3. Verify the snapshot is ready in Nomad before continuing
  4. Upgrade Waypoint to 0.11.0
  5. Verify Waypoint server version

```shell-session
$ nomad job stop waypoint-server
[...]
  ✓ Deployment "7a885db5" successful

    2023-02-14T15:44:44-08:00
    ID          = 7a885db5
    Job ID      = waypoint-server
    Job Version = 37
    Status      = successful
    Description = Deployment completed successfully

$ nomad volume snapshot create <volume-id> waypoint-0-11-upgrade
Snapshot ID                        Volume ID    Size    Create Time             Ready?
<volume-id>@waypoint-0-11-upgrade  <volume-id>  211MiB  2023-02-14-15:45-08:00  true

$ nomad job inspect waypoint-server > waypoint-server-0.10.json
$ # Make a copy of `waypoint-server.json` and set {"Job": "Stop": false} and the waypoint server image version to "0.11.0" in the "waypoint-server" task group.
$ # Submit the job to nomad to start again.

$ nomad job run -json waypoint-server-0.11.0.json
[...]
  ✓ Deployment "b82dc4a1" successful

    2023-02-14T15:49:12-08:00
    ID          = b82dc4a1
    Job ID      = waypoint-server
    Job Version = 38
    Status      = successful
    Description = Deployment completed successfully
```

If the upgrade fails, stop Waypoint server, revert the Nomad snapshot, and submit the original job to Nomad.

#### Verifying the Server Version with the UI

You can verify the server version by loading the UI and looking at the footer.
You should see a version starting with `v0.11.0`. If you see an earlier version,
your platform may be using an old cached image.

#### Verifying the Server Version with the CLI

You can verify both the CLI version and server version by running:

```shell-session
$ waypoint version
CLI: v0.11.0 (-------)
Server: v0.11.0
```
